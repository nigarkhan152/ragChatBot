{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 14, "column": 0}, "map": {"version":3,"sources":["file:///Users/administrator/Desktop/langbot/frontend/src/app/ask/%5Busername%5D/page.js"],"sourcesContent":["// \"use client\";\n\n// import { useState, useRef, useEffect } from \"react\";\n// import { Mic, MicOff, Send } from \"lucide-react\"; // ðŸ‘ˆ import icons\n// import { useRouter } from \"next/navigation\";\n\n// export default function AskPage() {\n//   const [user, setUser] = useState(null);\n//   const [token, setToken] = useState(null);\n//   const [messages, setMessages] = useState([\n//     { sender: \"bot\", text: \"Hi ðŸ‘‹! Ask me anything about your documents.\" },\n//   ]);\n//   const [chatHistory, setChatHistory] = useState([]);\n//   const [question, setQuestion] = useState(\"\");\n//   const [loading, setLoading] = useState(false);\n//   const [listening, setListening] = useState(false);\n//   const chatEndRef = useRef(null);\n//   const recognitionRef = useRef(null);\n//   const router = useRouter();\n//   // Load user & token from localStorage\n//   useEffect(()=>{\n//     const storedUser = JSON.parse(localStorage.getItem(\"user\"));\n//     const storedToken = localStorage.getItem(\"token\");\n//     if(!storedUser || !storedToken){\n//       router.push(\"/login\");\n//     }else{\n//       setUser(storedUser);\n//       setToken(storedToken);\n//       console.log(\"User loaded:\",storedUser);\n//     }\n//   },[router]);\n\n//   // Auto-scroll to bottom when messages update\n//   useEffect(() => {\n//     chatEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n//   }, [messages, loading]);\n\n//   //fetch chat history from backend\n//   useEffect(() => {\n//     if (user && token) {\n//       fetch(`http://localhost:8000/api/chats/${user.username}`, {\n//         headers: { Authorization: `Bearer ${token}` },\n//       })\n//         .then((res) => res.json())\n//         .then((data) => {\n//           if (data.chats) {\n//             setChatHistory(data.chats);\n//           }\n//         })\n//         .catch((err) => console.error(\"Error loading history:\", err));\n//     }\n//   }, [user, token]);\n\n//   // Load selected chat into main chat window\n//   const loadChat = (chat) => {\n//     const formatted = [\n//       { sender: \"user\", text: chat.question },\n//       { sender: \"bot\", text: chat.answer },\n//     ];\n//     setMessages([\n//       { sender: \"bot\", text: \"Hi ðŸ‘‹! Ask me anything about your documents.\" },\n//       ...formatted,\n//     ]);\n//   };\n\n//   // Initialize SpeechRecognition\n//   useEffect(() => {\n//     if (typeof window !== \"undefined\") {\n//       const SpeechRecognition =\n//         window.SpeechRecognition || window.webkitSpeechRecognition;\n\n//       if (SpeechRecognition) {\n//         const recognition = new SpeechRecognition();\n//         recognition.continuous = false;\n//         recognition.interimResults = true;\n//         recognition.lang = \"en-US\";\n\n//         recognition.onstart = () => setListening(true);\n//         recognition.onend = () => setListening(false);\n\n//         recognition.onresult = (event) => {\n//           let transcript = \"\";\n//           for (let i = event.resultIndex; i < event.results.length; i++) {\n//             transcript += event.results[i][0].transcript;\n//           }\n//           setQuestion(transcript);\n//         };\n\n//         recognitionRef.current = recognition;\n//       }\n//     }\n//   }, []);\n\n//   const handleAsk = async () => {\n//     if (!question.trim() || !user || !token) return;\n//     setLoading(true);\n\n//     const newMessages = [...messages, { sender: \"user\", text: question }];\n//     setMessages(newMessages);\n\n//     try {\n//       const res = await fetch(`http://localhost:8000/ask/${user.username}`, {\n//         method: \"POST\",\n//         headers: {\n//           \"Content-Type\": \"application/json\",\n//           Authorization: `Bearer ${token}`,\n//         },      \n//         body: JSON.stringify({ question, top_k: 3 }),\n//       });\n//       if (!res.ok) {\n//         const errText = await res.text();\n//         throw new Error(`Fetch failed: ${res.status} ${errText}`);\n//       }\n\n//       const data = await res.json();\n\n//       setMessages([\n//         ...newMessages,\n//         { sender: \"bot\", text: data.answer || \"Sorry, I couldnâ€™t find an answer.\" },\n//       ]);\n//           // Add to sidebar history\n//       setChatHistory((prev) => [\n//         ...prev,\n//         { question, answer: data.answer, timestamp: new Date().toISOString() },\n//       ]);\n//     } catch (err) {\n//       console.error(err);\n//       setMessages([\n//         ...newMessages,\n//         { sender: \"bot\", text: \"âš ï¸ Error: Could not fetch answer.\" },\n//       ]);\n//     } finally {\n//       setLoading(false);\n//       setQuestion(\"\");\n//     }\n//   };\n\n//   // Start/Stop voice recognition\n//   const handleVoiceInput = () => {\n//     if (!recognitionRef.current) {\n//       alert(\"Speech recognition not supported in this browser.\");\n//       return;\n//     }\n//     if (listening) {\n//       recognitionRef.current.stop();\n//     } else {\n//       recognitionRef.current.start();\n//     }\n//   };\n//   return (\n//     <div className=\"flex min-h-screen bg-black text-white\">\n//       {/* Sidebar for chat history */}\n//       <div className=\"w-64 bg-gray-900 p-4 border-r border-gray-700 overflow-y-auto\">\n//         <h2 className=\"text-lg font-bold text-purple-400 mb-4\">History</h2>\n//         <ul className=\"space-y-2\">\n//           {chatHistory.map((chat, idx) => (\n//             <li\n//               key={idx}\n//               onClick={() => loadChat(chat)}\n//               className=\"p-2 bg-gray-800 rounded-lg cursor-pointer hover:bg-gray-700\"\n//             >\n//             <span>ðŸ’¬</span>\n//             <p className=\"text-sm text-purple-300 truncate\">Chat {idx + 1}</p>\n//             </li>\n//           ))}\n//         </ul>\n//       </div>\n  \n//       {/* Main chat area */}\n//       <div className=\"flex-1 flex flex-col items-center justify-center p-6\">\n//         <h1 className=\"text-3xl font-bold text-purple-400 mb-6\">Chatbot</h1>\n//         <div className=\"w-full max-w-2xl flex flex-col bg-gray-900 rounded-2xl shadow-lg p-6\">\n//           {/* Chat window */}\n//           <div className=\"flex-1 overflow-y-auto mb-4 space-y-4 max-h-[70vh]\">\n//             {messages.map((msg, idx) => (\n//               <div\n//                 key={idx}\n//                 className={`flex ${msg.sender === \"user\" ? \"justify-end\" : \"justify-start\"}`}\n//               >\n//                 <div\n//                   className={`px-4 py-2 rounded-2xl max-w-xs flex items-center space-x-2 ${\n//                     msg.sender === \"user\"\n//                       ? \"bg-purple-600 text-white\"\n//                       : \"bg-gray-700 text-purple-200\"\n//                   }`}\n//                 >\n//                   <span>\n//                     {msg.sender === \"user\" ? \"ðŸ§‘\" : \"ðŸ¤–\"}\n//                   </span>\n//                   <span>{msg.text}</span>\n//                 </div>\n//               </div>\n//             ))}\n//             {loading && (\n//               <div className=\"flex justify-start\">\n//                 <div className=\"px-4 py-2 rounded-2xl bg-gray-700 text-purple-200 animate-pulse\">\n//                   Thinking...\n//                 </div>\n//               </div>\n//             )}\n//             <div ref={chatEndRef} />\n//           </div>\n  \n//           {/* Input box */}\n//           <div className=\"flex items-center space-x-2\">\n//             <input\n//               type=\"text\"\n//               className=\"flex-1 p-3 rounded-xl bg-gray-800 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-purple-500\"\n//               placeholder=\"Type or speak your question...\"\n//               value={question}\n//               onChange={(e) => setQuestion(e.target.value)}\n//               onKeyDown={(e) => e.key === \"Enter\" && handleAsk()}\n//             />\n//             <button\n//               onClick={handleVoiceInput}\n//               className={`p-3 rounded-xl transition ${\n//                 listening\n//                   ? \"bg-red-600 hover:bg-red-700\"\n//                   : \"bg-gray-600 hover:bg-gray-700\"\n//               }`}\n//             >\n//               {listening ? <MicOff className=\"w-5 h-5\" /> : <Mic className=\"w-5 h-5\" />}\n//             </button>\n//             <button\n//               onClick={handleAsk}\n//               disabled={loading}\n//               className=\"bg-purple-600 hover:bg-purple-700 text-white p-3 rounded-xl disabled:bg-gray-600\"\n//             >\n//               <Send className=\"w-5 h-5\" />\n//             </button>\n//           </div>\n//         </div>\n//       </div>\n//     </div>\n//   );\n// }\n\n"],"names":[],"mappings":"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","debugId":null}}]
}