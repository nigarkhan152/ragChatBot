{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/administrator/Desktop/langbot/frontend/src/app/ask/%5Busername%5D/page.js"],"sourcesContent":["\"use client\";\n\nimport { useState, useRef, useEffect } from \"react\";\nimport { Mic, MicOff, Send ,History,X,Home,Logout} from \"lucide-react\"; // ðŸ‘ˆ import icons\nimport { useRouter } from \"next/navigation\";\n\nexport default function AskPage() {\n  const [user, setUser] = useState(null);\n  const [token, setToken] = useState(null);\n  const [messages, setMessages] = useState([\n    { sender: \"bot\", text: \"Hi ðŸ‘‹! Ask me anything about your documents.\" },\n  ]);\n  const [chatHistory, setChatHistory] = useState([]);\n  const [question, setQuestion] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [listening, setListening] = useState(false);\n  const [showHistory, setShowHistory] = useState(false); // ðŸ‘ˆ toggle state\n  const chatEndRef = useRef(null);\n  const recognitionRef = useRef(null);\n  const router = useRouter();\n  // Load user & token from localStorage\n  useEffect(()=>{\n    const storedUser = JSON.parse(localStorage.getItem(\"user\"));\n    const storedToken = localStorage.getItem(\"token\");\n    if(!storedUser || !storedToken){\n      router.push(\"/login\");\n    }else{\n      setUser(storedUser);\n      setToken(storedToken);\n      console.log(\"User loaded:\",storedUser);\n    }\n  },[router]);\n\n  // Auto-scroll to bottom when messages update\n  useEffect(() => {\n    chatEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages, loading]);\n\n  //fetch chat history from backend\n  useEffect(() => {\n    if (user && token) {\n      fetch(`http://localhost:8000/api/chats/${user.username}`, {\n        headers: { Authorization: `Bearer ${token}` },\n      })\n        .then((res) => res.json())\n        .then((data) => {\n          if (data.chats) {\n            setChatHistory(data.chats);\n          }\n        })\n        .catch((err) => console.error(\"Error loading history:\", err));\n    }\n  }, [user, token]);\n\n  // Load selected chat into main chat window\n  const loadChat = (chat) => {\n    const formatted = [\n      { sender: \"user\", text: chat.question },\n      { sender: \"bot\", text: chat.answer },\n    ];\n    setMessages([\n      { sender: \"bot\", text: \"Hi ðŸ‘‹! Ask me anything about your documents.\" },\n      ...formatted,\n    ]);\n    setShowHistory(false); // ðŸ‘ˆ hide after selecting chat\n  };\n\n  // Initialize SpeechRecognition\n  useEffect(() => {\n    if (typeof window !== \"undefined\") {\n      const SpeechRecognition =\n        window.SpeechRecognition || window.webkitSpeechRecognition;\n\n      if (SpeechRecognition) {\n        const recognition = new SpeechRecognition();\n        recognition.continuous = false;\n        recognition.interimResults = true;\n        recognition.lang = \"en-US\";\n\n        recognition.onstart = () => setListening(true);\n        recognition.onend = () => setListening(false);\n\n        recognition.onresult = (event) => {\n          let transcript = \"\";\n          for (let i = event.resultIndex; i < event.results.length; i++) {\n            transcript += event.results[i][0].transcript;\n          }\n          setQuestion(transcript);\n        };\n\n        recognitionRef.current = recognition;\n      }\n    }\n  }, []);\n\n  const handleAsk = async () => {\n    if (!question.trim() || !user || !token) return;\n    setLoading(true);\n\n    const newMessages = [...messages, { sender: \"user\", text: question }];\n    setMessages(newMessages);\n\n    try {\n      const res = await fetch(`http://localhost:8000/ask/${user.username}`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${token}`,\n        },      \n        body: JSON.stringify({ question, top_k: 3 }),\n      });\n      if (!res.ok) {\n        const errText = await res.text();\n        throw new Error(`Fetch failed: ${res.status} ${errText}`);\n      }\n\n      const data = await res.json();\n\n      setMessages([\n        ...newMessages,\n        { sender: \"bot\", text: data.answer || \"Sorry, I couldnâ€™t find an answer.\" },\n      ]);\n          // Add to sidebar history\n      setChatHistory((prev) => [\n        ...prev,\n        { question, answer: data.answer, timestamp: new Date().toISOString() },\n      ]);\n    } catch (err) {\n      console.error(err);\n      setMessages([\n        ...newMessages,\n        { sender: \"bot\", text: \"âš ï¸ Error: Could not fetch answer.\" },\n      ]);\n    } finally {\n      setLoading(false);\n      setQuestion(\"\");\n    }\n  };\n\n  // Start/Stop voice recognition\n  const handleVoiceInput = () => {\n    if (!recognitionRef.current) {\n      alert(\"Speech recognition not supported in this browser.\");\n      return;\n    }\n    if (listening) {\n      recognitionRef.current.stop();\n    } else {\n      recognitionRef.current.start();\n    }\n  };\n  // return (\n  //   <div className=\"flex min-h-screen bg-black text-white relative\">\n  //     {/* Sidebar (History) */}\n  //     {showHistory && (\n  //       <div className=\"w-64 bg-gray-900 p-4 border-l border-gray-700 overflow-y-auto absolute right-0 top-0 h-full z-20 shadow-lg\">\n  //         <div className=\"flex justify-between items-center mb-4\">\n  //           <h2 className=\"text-lg font-bold text-purple-400\">History</h2>\n  //           <button onClick={() => setShowHistory(false)}>\n  //             <X className=\"w-5 h-5 text-purple-400\" />\n  //           </button>\n  //         </div>\n  //         <ul className=\"space-y-2\">\n  //           {chatHistory.map((chat, idx) => (\n  //             <li\n  //               key={idx}\n  //               onClick={() => loadChat(chat)}\n  //               className=\"p-2 bg-gray-800 rounded-lg cursor-pointer hover:bg-gray-700 flex items-center space-x-2\"\n  //             >\n  //               <span>ðŸ’¬</span>\n  //               <p className=\"text-sm text-purple-300\">Chat {idx + 1}</p>\n  //             </li>\n  //           ))}\n  //         </ul>\n  //       </div>\n  //     )}\n\n  //     {/* Main chat area */}\n  //     <div className=\"flex-1 flex flex-col items-center justify-center p-6\">\n  //       <div className=\"w-full relative mb-6\">\n  //         <h1 className=\"text-5xl text-center font-extrabold text-purple-400 animate-pulse\">Chatbot</h1>\n  //         <button\n  //           onClick={() => setShowHistory(!showHistory)}\n  //           className=\"absolute right-0 top-1/2 transform -translate-y-1/2 bg-gray-700 hover:bg-gray-600 p-2 rounded-lg flex items-center space-x-2\"\n  //         >\n  //           <History className=\"w-5 h-5 text-purple-300\" />\n  //           <span className=\"text-purple-300\">History</span>\n  //         </button>\n  //       </div>\n\n  //       <div className=\"w-full max-w-2xl flex flex-col bg-gray-900 rounded-2xl shadow-lg p-6\">\n  //         {/* Chat window */}\n  //         <div className=\"flex-1 overflow-y-auto mb-4 space-y-4 max-h-[70vh]\">\n  //           {messages.map((msg, idx) => (\n  //             <div\n  //               key={idx}\n  //               className={`flex ${msg.sender === \"user\" ? \"justify-end\" : \"justify-start\"}`}\n  //             >\n  //               <div\n  //                 className={`px-4 py-2 rounded-2xl max-w-xs flex items-center space-x-2 ${\n  //                   msg.sender === \"user\"\n  //                     ? \"bg-purple-600 text-white\"\n  //                     : \"bg-gray-700 text-purple-200\"\n  //                 }`}\n  //               >\n  //                 <span>{msg.sender === \"user\" ? \"ðŸ§‘\" : \"ðŸ¤–\"}</span>\n  //                 <span>{msg.text}</span>\n  //               </div>\n  //             </div>\n  //           ))}\n  //           {loading && (\n  //             <div className=\"flex justify-start\">\n  //               <div className=\"px-4 py-2 rounded-2xl bg-gray-700 text-purple-200 animate-pulse flex items-center space-x-2\">\n  //                 <span>ðŸ¤–</span>\n  //                 <span>Typingâ€¦</span>\n  //               </div>\n  //             </div>\n  //           )}\n  //           <div ref={chatEndRef} />\n  //         </div>\n\n  //         {/* Input box */}\n  //         <div className=\"flex items-center space-x-2\">\n  //           <input\n  //             type=\"text\"\n  //             className=\"flex-1 p-3 rounded-xl bg-gray-800 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-purple-500\"\n  //             placeholder=\"Type or speak your question...\"\n  //             value={question}\n  //             onChange={(e) => setQuestion(e.target.value)}\n  //             onKeyDown={(e) => e.key === \"Enter\" && handleAsk()}\n  //           />\n  //           <button\n  //             onClick={handleVoiceInput}\n  //             className={`p-3 rounded-xl transition ${\n  //               listening\n  //                 ? \"bg-red-600 hover:bg-red-700\"\n  //                 : \"bg-gray-600 hover:bg-gray-700\"\n  //             }`}\n  //           >\n  //             {listening ? <MicOff className=\"w-5 h-5\" /> : <Mic className=\"w-5 h-5\" />}\n  //           </button>\n  //           <button\n  //             onClick={handleAsk}\n  //             disabled={loading}\n  //             className=\"bg-purple-600 hover:bg-purple-700 text-white p-3 rounded-xl disabled:bg-gray-600\"\n  //           >\n  //             <Send className=\"w-5 h-5\" />\n  //           </button>\n  //         </div>\n  //       </div>\n  //     </div>\n  //   </div>\n  // );\n  \n\n}\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 321, "column": 0}, "map": {"version":3,"sources":["file:///Users/administrator/Desktop/langbot/frontend/node_modules/next/navigation.js"],"sourcesContent":["module.exports = require('./dist/client/components/navigation')\n"],"names":[],"mappings":"AAAA,OAAO,OAAO","ignoreList":[0],"debugId":null}}]
}